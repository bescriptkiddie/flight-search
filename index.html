<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>航班信息筛选系统</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 使用Unicode图标替代阿里图标库 -->
    <style>
      .icon-airplane::before { content: '✈️'; }
      .icon-search::before { content: '🔍'; }
      .icon-close::before { content: '✖️'; }
      .icon-filter::before { content: '🔽'; }
      .icon-arrow-down::before { content: '⬇️'; }
      .icon-tips::before { content: '💡'; }
      .icon-departure::before { content: '🛫'; }
      .icon-arrival::before { content: '🛬'; }
      .icon-location::before { content: '📍'; }
      .icon-flight-number::before { content: '🔢'; }
      .icon-product::before { content: '📦'; }
      .icon-time::before { content: '⏰'; }
      .icon-clock::before { content: '🕐'; }
      .icon-calendar::before { content: '📅'; }
      .icon-empty::before { content: '📭'; }
      .icon-moon::before { content: '🌙'; }
      .icon-sun::before { content: '☀️'; }
      .icon-export::before { content: '📤'; }
      .icon-reset::before { content: '🔄'; }
      .icon-apply::before { content: '✅'; }
      .iconfont { font-style: normal; }
    </style>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              'sans': ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Microsoft YaHei', 'sans-serif']
            },
            animation: {
              'fade-in': 'fadeIn 0.5s ease-in-out',
              'slide-down': 'slideDown 0.4s ease-out',
              'slide-up': 'slideUp 0.4s ease-out'
            }
          }
        }
      }
    </script>
    <style>
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      @keyframes slideDown {
        from { opacity: 0; max-height: 0; transform: translateY(-20px); }
        to { opacity: 1; max-height: 1000px; transform: translateY(0); }
      }
      @keyframes slideUp {
        from { opacity: 1; max-height: 1000px; transform: translateY(0); }
        to { opacity: 0; max-height: 0; transform: translateY(-20px); }
      }
      .search-highlight {
        background-color: #fef3c7;
        padding: 2px 6px;
        border-radius: 4px;
        font-weight: bold;
        color: #92400e;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen font-sans">
    <div class="max-w-7xl mx-auto px-4 py-6">
      <h1 class="text-4xl md:text-5xl font-bold text-center mb-8 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent animate-fade-in">
        <i class="iconfont icon-airplane text-blue-500 mr-3"></i>
        航班信息筛选系统
      </h1>

      <!-- 快捷搜索区域 -->
      <div class="bg-white/80 backdrop-blur-lg rounded-2xl shadow-xl p-6 mb-6 border border-white/20 animate-fade-in">
        <div class="flex flex-col lg:flex-row gap-4 items-end">
          <!-- 搜索输入框 -->
          <div class="flex-1 relative">
            <label class="block text-sm font-semibold text-gray-700 mb-3">
              <i class="iconfont icon-search text-blue-500 mr-2 text-lg"></i>
              快捷搜索
            </label>
            <div class="relative group">
              <input
                type="text"
                id="locationSearch"
                class="w-full pl-12 pr-12 py-4 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-300 bg-gray-50/50 focus:bg-white text-gray-800 placeholder-gray-400 shadow-sm hover:shadow-md"
                placeholder="输入城市名或省份名快速搜索航班..."
                oninput="performLocationSearch()"
              />
              <!-- 搜索图标 -->
              <i class="iconfont icon-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 text-xl group-focus-within:text-blue-500 transition-colors"></i>

              <!-- 清除按钮 -->
              <button
                onclick="clearLocationSearch()"
                class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-red-500 transition-all duration-200 hover:scale-110 p-1 rounded-full hover:bg-red-50"
                title="清空搜索"
              >
                <i class="iconfont icon-close text-lg"></i>
              </button>
            </div>
          </div>

          <!-- 详细搜索切换按钮 -->
          <div class="flex-shrink-0">
            <button
              class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-8 py-4 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-3 font-semibold hover:-translate-y-1 active:translate-y-0"
              id="toggleBtn"
              onclick="toggleAdvancedSearch()"
            >
              <i class="iconfont icon-filter text-lg"></i>
              <span id="toggleText">详细搜索</span>
              <i class="iconfont icon-arrow-down transition-transform duration-300" id="toggleIcon"></i>
            </button>
          </div>
        </div>

        <!-- 搜索提示信息 -->
        <div class="mt-6" id="searchResultsInfo">
          <div class="flex items-center gap-4 text-sm text-gray-600 bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-4 rounded-xl border border-blue-100 shadow-sm">
            <i class="iconfont icon-tips text-blue-500 text-xl animate-pulse"></i>
            <span class="font-medium">输入城市名或省份名，系统将自动筛选相关航班</span>
          </div>
        </div>
      </div>

      <!-- 详细搜索面板 -->
      <div class="bg-white/80 backdrop-blur-lg rounded-2xl shadow-xl p-6 mb-6 border border-white/20 transition-all duration-500" id="advancedFilters" style="display: none;">
        <!-- 第一行 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
          <div class="relative group">
            <label class="block text-sm font-semibold text-gray-700 mb-3">
              <i class="iconfont icon-airplane text-blue-500 mr-2"></i>航空公司
            </label>
            <select id="airline" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50/50 focus:bg-white shadow-sm hover:shadow-md">
              <option value="">全部</option>
            </select>
          </div>

          <div class="relative group">
            <label class="block text-sm font-semibold text-gray-700 mb-3">
              <i class="iconfont icon-departure text-green-500 mr-2"></i>出发城市
            </label>
            <select id="departure" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50/50 focus:bg-white shadow-sm hover:shadow-md">
              <option value="">全部</option>
            </select>
          </div>

          <div class="relative group">
            <label class="block text-sm font-semibold text-gray-700 mb-3">
              <i class="iconfont icon-arrival text-red-500 mr-2"></i>到达城市
            </label>
            <select id="destination" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50/50 focus:bg-white shadow-sm hover:shadow-md">
              <option value="">全部</option>
            </select>
          </div>

          <div class="relative group">
            <label class="block text-sm font-semibold text-gray-700 mb-3">
              <i class="iconfont icon-location text-purple-500 mr-2"></i>出发省份
            </label>
            <select id="departureProvince" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50/50 focus:bg-white shadow-sm hover:shadow-md">
              <option value="">全部</option>
            </select>
          </div>
        </div>

        <!-- 第二行 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
          <div class="relative group">
            <label class="block text-sm font-semibold text-gray-700 mb-3">
              <i class="iconfont icon-location text-indigo-500 mr-2"></i>到达省份
            </label>
            <select id="destinationProvince" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50/50 focus:bg-white shadow-sm hover:shadow-md">
              <option value="">全部</option>
            </select>
          </div>

          <div class="relative group">
            <label class="block text-sm font-semibold text-gray-700 mb-3">
              <i class="iconfont icon-flight-number text-orange-500 mr-2"></i>航班号
            </label>
            <input type="text" id="flightNumber" placeholder="输入航班号" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50/50 focus:bg-white shadow-sm hover:shadow-md" />
          </div>

          <div class="relative group">
             <label class="block text-sm font-semibold text-gray-700 mb-3">
               <i class="iconfont icon-product text-teal-500 mr-2"></i>产品类型
             </label>
             <select id="productType" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50/50 focus:bg-white shadow-sm hover:shadow-md">
               <option value="">全部</option>
             </select>
           </div>

           <div class="relative group">
             <label class="block text-sm font-semibold text-gray-700 mb-3">
               <i class="iconfont icon-time text-pink-500 mr-2"></i>航班类型
             </label>
             <div class="flex flex-wrap gap-3">
               <label class="flex items-center gap-2 cursor-pointer px-3 py-2 rounded-lg hover:bg-blue-50 transition-colors">
                 <input type="checkbox" id="nightFlight" value="true" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                 <span class="text-sm font-medium text-gray-700">红眼航班</span>
               </label>
               <label class="flex items-center gap-2 cursor-pointer px-3 py-2 rounded-lg hover:bg-blue-50 transition-colors">
                 <input type="checkbox" id="dayFlight" value="true" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                 <span class="text-sm font-medium text-gray-700">日间航班</span>
               </label>
             </div>
           </div>
         </div>

         <!-- 第三行 -->
         <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
           <div class="relative group">
             <label class="block text-sm font-semibold text-gray-700 mb-3">
               <i class="iconfont icon-clock text-amber-500 mr-2"></i>起飞时间
             </label>
             <select id="departureTime" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50/50 focus:bg-white shadow-sm hover:shadow-md">
               <option value="">全部</option>
               <option value="early">凌晨 (00:00-06:00)</option>
               <option value="morning">上午 (06:00-12:00)</option>
               <option value="afternoon">下午 (12:00-18:00)</option>
               <option value="evening">晚上 (18:00-24:00)</option>
             </select>
           </div>

           <div class="relative group">
             <label class="block text-sm font-semibold text-gray-700 mb-3">
               <i class="iconfont icon-calendar text-emerald-500 mr-2"></i>运营日期
             </label>
             <div class="grid grid-cols-4 md:grid-cols-7 gap-2">
               <label class="flex items-center justify-center gap-1 cursor-pointer px-2 py-2 rounded-lg hover:bg-blue-50 transition-colors text-center">
                 <input type="checkbox" class="day-checkbox w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500" value="1" />
                 <span class="text-xs font-medium text-gray-700">周一</span>
               </label>
               <label class="flex items-center justify-center gap-1 cursor-pointer px-2 py-2 rounded-lg hover:bg-blue-50 transition-colors text-center">
                 <input type="checkbox" class="day-checkbox w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500" value="2" />
                 <span class="text-xs font-medium text-gray-700">周二</span>
               </label>
               <label class="flex items-center justify-center gap-1 cursor-pointer px-2 py-2 rounded-lg hover:bg-blue-50 transition-colors text-center">
                 <input type="checkbox" class="day-checkbox w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500" value="3" />
                 <span class="text-xs font-medium text-gray-700">周三</span>
               </label>
               <label class="flex items-center justify-center gap-1 cursor-pointer px-2 py-2 rounded-lg hover:bg-blue-50 transition-colors text-center">
                 <input type="checkbox" class="day-checkbox w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500" value="4" />
                 <span class="text-xs font-medium text-gray-700">周四</span>
               </label>
               <label class="flex items-center justify-center gap-1 cursor-pointer px-2 py-2 rounded-lg hover:bg-blue-50 transition-colors text-center">
                 <input type="checkbox" class="day-checkbox w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500" value="5" />
                 <span class="text-xs font-medium text-gray-700">周五</span>
               </label>
               <label class="flex items-center justify-center gap-1 cursor-pointer px-2 py-2 rounded-lg hover:bg-blue-50 transition-colors text-center">
                 <input type="checkbox" class="day-checkbox w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500" value="6" />
                 <span class="text-xs font-medium text-gray-700">周六</span>
               </label>
               <label class="flex items-center justify-center gap-1 cursor-pointer px-2 py-2 rounded-lg hover:bg-blue-50 transition-colors text-center">
                 <input type="checkbox" class="day-checkbox w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500" value="7" />
                 <span class="text-xs font-medium text-gray-700">周日</span>
               </label>
             </div>
           </div>
         </div>

         <!-- 按钮组 -->
         <div class="flex flex-col sm:flex-row gap-4">
           <button class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-6 py-3 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl font-semibold hover:-translate-y-1 active:translate-y-0" onclick="applyFilters()">
             <i class="iconfont icon-check mr-2"></i>
             应用筛选
           </button>
           <button class="flex-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-6 py-3 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl font-semibold hover:-translate-y-1 active:translate-y-0" onclick="resetFilters()">
             <i class="iconfont icon-refresh mr-2"></i>
             重置筛选
           </button>
         </div>
       </div>

       <!-- 查询结果信息 -->
       <div class="bg-white/80 backdrop-blur-lg rounded-2xl shadow-xl p-6 mb-6 border border-white/20">
         <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
           <div>
             <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
               <i class="iconfont icon-data text-blue-500 text-2xl"></i>
               查询结果
             </h3>
             <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
               <div class="flex items-center gap-3 px-4 py-3 bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl border border-blue-200">
                 <i class="iconfont icon-airplane text-blue-500 text-xl"></i>
                 <div>
                   <span class="text-sm text-gray-600 block">总航班数</span>
                   <span class="text-xl font-bold text-blue-600" id="totalFlights">0</span>
                 </div>
               </div>
               <div class="flex items-center gap-3 px-4 py-3 bg-gradient-to-r from-purple-50 to-purple-100 rounded-xl border border-purple-200">
                 <i class="iconfont icon-moon text-purple-500 text-xl"></i>
                 <div>
                   <span class="text-sm text-gray-600 block">红眼航班</span>
                   <span class="text-xl font-bold text-purple-600" id="nightFlights">0</span>
                 </div>
               </div>
               <div class="flex items-center gap-3 px-4 py-3 bg-gradient-to-r from-orange-50 to-orange-100 rounded-xl border border-orange-200">
                 <i class="iconfont icon-sun text-orange-500 text-xl"></i>
                 <div>
                   <span class="text-sm text-gray-600 block">日间航班</span>
                   <span class="text-xl font-bold text-orange-600" id="dayFlights">0</span>
                 </div>
               </div>
             </div>
           </div>
           <div class="flex-shrink-0">
             <button class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 py-3 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl font-semibold hover:-translate-y-1 active:translate-y-0 flex items-center gap-2" onclick="exportResults()">
               <i class="iconfont icon-download text-lg"></i>
               导出结果
             </button>
           </div>
         </div>
       </div>

       <!-- 航班列表 -->
       <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
         <div class="overflow-x-auto">
           <table id="flightTable" class="w-full">
             <thead>
               <tr class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white">
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-airplane mr-2"></i>航空公司
                 </th>
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-flight-number mr-2"></i>航班号
                 </th>
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-departure mr-2"></i>出发城市
                 </th>
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-arrival mr-2"></i>到达城市
                 </th>
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-time mr-2"></i>出发时间
                 </th>
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-time mr-2"></i>到达时间
                 </th>
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-calendar mr-2"></i>运营日期
                 </th>
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-product mr-2"></i>产品类型
                 </th>
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-type mr-2"></i>航班类型
                 </th>
               </tr>
             </thead>
             <tbody id="flightTableBody" class="divide-y divide-gray-100">
               <tr>
                 <td colspan="9" class="px-6 py-12 text-center text-gray-500 animate-pulse">
                   <i class="iconfont icon-loading text-3xl mb-2 block"></i>
                   正在加载数据...
                 </td>
               </tr>
             </tbody>
           </table>
         </div>
       </div>
     </div>
      /* 夜间航班标识 */
      .night-flight {
        @apply border-l-4 border-blue-600 bg-gradient-to-r from-blue-50 to-white;
      }

      /* 搜索高亮 */
      .search-highlight {
        @apply bg-yellow-100 px-2 py-1 rounded font-semibold text-yellow-800;
      }

      /* 自定义滚动条 */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f5f9;
      }

      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="text-4xl md:text-5xl font-bold text-center mb-8 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">✈️ 航班信息筛选系统</h1>

      <!-- 快捷搜索区域 -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-6 border border-gray-100">
        <div class="flex flex-col lg:flex-row gap-4 items-end">
          <!-- 搜索输入框 -->
          <div class="flex-1 relative">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="iconfont icon-search text-blue-500 mr-1"></i>
              快捷搜索
            </label>
            <div class="relative">
              <input
                type="text"
                id="locationSearch"
                class="w-full pl-10 pr-10 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 bg-gray-50 focus:bg-white"
                placeholder="输入城市名或省份名快速搜索航班..."
                oninput="performLocationSearch()"
              />
              <!-- 搜索图标 -->
              <i class="iconfont icon-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-lg"></i>

              <!-- 清除按钮 -->
              <button
                onclick="clearLocationSearch()"
                class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors"
                title="清空搜索"
              >
                <i class="iconfont icon-close text-lg"></i>
              </button>
            </div>
          </div>

          <!-- 详细搜索切换按钮 -->
          <div class="flex-shrink-0">
            <button
              class="btn-toggle bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-6 py-3 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg flex items-center gap-2"
              id="toggleBtn"
              onclick="toggleAdvancedSearch()"
            >
              <i class="iconfont icon-filter text-sm"></i>
              <span id="toggleText">详细搜索</span>
              <i class="iconfont icon-arrow-down transition-transform duration-200" id="toggleIcon"></i>
            </button>
          </div>
        </div>

        <!-- 搜索提示信息 -->
        <div class="mt-4" id="searchResultsInfo">
          <div class="flex items-center gap-3 text-sm text-gray-600 bg-gradient-to-r from-blue-50 to-indigo-50 px-4 py-3 rounded-lg border border-blue-100">
            <i class="iconfont icon-tips text-blue-500 text-lg animate-pulse"></i>
            <span>输入城市名或省份名，系统将自动筛选相关航班</span>
          </div>
        </div>
      </div>

      <!-- 详细搜索面板 -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-6 border border-gray-100" id="advancedFilters" style="display: none;">
        <!-- 第一行 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
          <div class="relative">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="iconfont icon-airplane text-blue-500 mr-1"></i>航空公司
            </label>
            <select id="airline" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200">
              <option value="">全部</option>
            </select>
          </div>

          <div class="relative">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="iconfont icon-departure text-green-500 mr-1"></i>出发城市
            </label>
            <select id="departure" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200">
              <option value="">全部</option>
            </select>
          </div>

          <div class="relative">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="iconfont icon-arrival text-red-500 mr-1"></i>到达城市
            </label>
            <select id="destination" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200">
              <option value="">全部</option>
            </select>
          </div>

          <div class="relative">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="iconfont icon-location text-purple-500 mr-1"></i>出发省份
            </label>
            <select id="departureProvince" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200">
              <option value="">全部</option>
            </select>
          </div>
        </div>

        <!-- 第二行 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
          <div class="relative">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="iconfont icon-location text-indigo-500 mr-1"></i>到达省份
            </label>
            <select id="destinationProvince" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200">
              <option value="">全部</option>
            </select>
          </div>

          <div class="relative">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="iconfont icon-flight-number text-orange-500 mr-1"></i>航班号
            </label>
            <input type="text" id="flightNumber" placeholder="输入航班号" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200" />
          </div>

          <div class="filter-group">
            <label for="productType">产品类型</label>
            <select id="productType">
              <option value="">全部</option>
            </select>
          </div>

          <div class="filter-group">
            <label>航班类型</label>
            <div class="checkbox-group">
              <label>
                <input type="checkbox" id="nightFlight" value="true" />
                红眼航班
              </label>
              <label>
                <input type="checkbox" id="dayFlight" value="true" />
                日间航班
              </label>
            </div>
          </div>
        </div>

        <div class="filter-row">
          <div class="filter-group">
            <label for="departureTime">起飞时间</label>
            <select id="departureTime">
              <option value="">全部</option>
              <option value="early">凌晨 (00:00-06:00)</option>
              <option value="morning">上午 (06:00-12:00)</option>
              <option value="afternoon">下午 (12:00-18:00)</option>
              <option value="evening">晚上 (18:00-24:00)</option>
            </select>
          </div>

          <div class="filter-group">
            <label for="operatingDays">运营日期</label>
            <div class="checkbox-group">
              <label
                ><input type="checkbox" class="day-checkbox" value="1" />
                周一</label
              >
              <label
                ><input type="checkbox" class="day-checkbox" value="2" />
                周二</label
              >
              <label
                ><input type="checkbox" class="day-checkbox" value="3" />
                周三</label
              >
              <label
                ><input type="checkbox" class="day-checkbox" value="4" />
                周四</label
              >
              <label
                ><input type="checkbox" class="day-checkbox" value="5" />
                周五</label
              >
              <label
                ><input type="checkbox" class="day-checkbox" value="6" />
                周六</label
              >
              <label
                ><input type="checkbox" class="day-checkbox" value="7" />
                周日</label
              >
            </div>
          </div>
        </div>

        <div class="button-group">
          <button class="btn-primary" onclick="applyFilters()">应用筛选</button>
          <button class="btn-secondary" onclick="resetFilters()">
            重置筛选
          </button>
        </div>
      </div>

      <div class="results-info">
        <div>
          <h3>查询结果</h3>
          <div class="stats">
            <div class="stat-item">
              <span class="stat-label">总航班数：</span>
              <span class="stat-value" id="totalFlights">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">红眼航班：</span>
              <span class="stat-value" id="nightFlights">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">日间航班：</span>
              <span class="stat-value" id="dayFlights">0</span>
            </div>
          </div>
        </div>
        <div>
          <button class="btn-primary" onclick="exportResults()">
            导出结果
          </button>
        </div>
      </div>

      <div class="flight-table">
        <table id="flightTable">
          <thead>
            <tr>
              <th>航空公司</th>
              <th>航班号</th>
              <th>出发城市</th>
              <th>到达城市</th>
              <th>出发时间</th>
              <th>到达时间</th>
              <th>运营日期</th>
              <th>产品类型</th>
              <th>航班类型</th>
            </tr>
          </thead>
          <tbody id="flightTableBody">
            <tr>
              <td colspan="9" class="loading">正在加载数据...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <script>
      let flightData = []
      let filteredData = []
      let originalFilteredData = [] // 保存原始筛选结果，用于地点搜索

      // 加载航班数据
      async function loadFlightData() {
        console.log("开始加载航班数据...")
        document.getElementById("flightTableBody").innerHTML =
          '<tr><td colspan="9" class="no-results">正在加载数据，请稍候...</td></tr>'

        // 优先尝试本地数据
        try {
          console.log("尝试加载本地数据: ./flights_data.json")
          const localResponse = await fetch("./flights_data.json")
          if (localResponse.ok) {
            const localData = await localResponse.json()
            console.log("成功加载本地数据:", localData)
            console.log(
              "航班数量:",
              localData.flights ? localData.flights.length : 0
            )

            if (localData.flights && Array.isArray(localData.flights)) {
              flightData = localData.flights
              console.log("本地数据加载完成，开始初始化筛选器")
              initializeFilters()
              applyFilters()
              console.log("页面初始化完成")
              return
            }
          }
        } catch (localError) {
          console.log("本地数据不可用，尝试在线数据:", localError.message)
        }

        // 如果本地数据不可用，尝试在线数据
        try {
          console.log(
            "发送网络请求到: https://flight-route.surge.sh/flights_data.json"
          )

          // 尝试使用CORS代理
          const corsProxyUrls = [
            "https://cors-anywhere.herokuapp.com/https://flight-route.surge.sh/flights_data.json",
            "https://api.allorigins.win/get?url=https://flight-route.surge.sh/flights_data.json",
            "https://flight-route.surge.sh/flights_data.json"
          ]

          let response = null
          let data = null

          for (const url of corsProxyUrls) {
            try {
              console.log("尝试URL:", url)
              response = await fetch(url, {
                method: "GET",
                mode: "cors",
                headers: {
                  Accept: "application/json"
                }
              })

              if (response.ok) {
                console.log("响应状态:", response.status, response.statusText)
                const responseData = await response.json()

                // 处理不同代理的响应格式
                if (url.includes("allorigins.win")) {
                  data = JSON.parse(responseData.contents)
                } else {
                  data = responseData
                }

                console.log("成功获取在线数据:", data)
                break
              }
            } catch (proxyError) {
              console.log(`代理 ${url} 失败:`, proxyError.message)
              continue
            }
          }

          if (!data || !data.flights || !Array.isArray(data.flights)) {
            throw new Error("无法获取有效的航班数据")
          }

          console.log("航班数量:", data.flights.length)
          flightData = data.flights
          console.log("在线数据加载完成，开始初始化筛选器")
          initializeFilters()
          applyFilters()
          console.log("页面初始化完成")
        } catch (error) {
          console.error("所有数据源加载失败:", error)
          console.error("错误详情:", error.message)

          document.getElementById(
            "flightTableBody"
          ).innerHTML = `<tr><td colspan="9" class="no-results">数据加载失败: ${error.message}<br><br>可能的原因：<br>1. 本地文件 flights_data.json 不存在<br>2. 网络连接问题<br>3. 跨域请求被阻止<br>4. 服务器暂时不可用<br><br><button class="btn-primary" onclick="loadFlightData()">重试</button><br><br><button class="btn-primary" onclick="document.querySelector('input[type=file]').click()">选择本地文件</button></td></tr>`
        }
      }

      // 初始化筛选器选项
      function initializeFilters() {
        const airlines = [...new Set(flightData.map((f) => f.airline))].sort()
        const departures = [
          ...new Set(flightData.map((f) => f.departure))
        ].sort()
        const destinations = [
          ...new Set(flightData.map((f) => f.destination))
        ].sort()
        const departureProvinces = [
          ...new Set(flightData.map((f) => f.departure_province))
        ].sort()
        const destinationProvinces = [
          ...new Set(flightData.map((f) => f.destination_province))
        ].sort()
        const productTypes = [
          ...new Set(flightData.map((f) => f.product_type))
        ].sort()

        populateSelect("airline", airlines)
        populateSelect("departure", departures)
        populateSelect("destination", destinations)
        populateSelect("departureProvince", departureProvinces)
        populateSelect("destinationProvince", destinationProvinces)
        populateSelect("productType", productTypes)
      }

      // 填充下拉选项
      function populateSelect(id, options) {
        const select = document.getElementById(id)
        options.forEach((option) => {
          const optionElement = document.createElement("option")
          optionElement.value = option
          optionElement.textContent = option
          select.appendChild(optionElement)
        })
      }

      // 应用筛选
      function applyFilters() {
        const filters = {
          airline: document.getElementById("airline").value,
          departure: document.getElementById("departure").value,
          destination: document.getElementById("destination").value,
          departureProvince: document.getElementById("departureProvince").value,
          destinationProvince: document.getElementById("destinationProvince")
            .value,
          flightNumber: document
            .getElementById("flightNumber")
            .value.toUpperCase(),
          productType: document.getElementById("productType").value,
          nightFlight: document.getElementById("nightFlight").checked,
          dayFlight: document.getElementById("dayFlight").checked,
          departureTime: document.getElementById("departureTime").value,
          operatingDays: Array.from(
            document.querySelectorAll(".day-checkbox:checked")
          ).map((cb) => cb.value)
        }

        filteredData = flightData.filter((flight) => {
          // 基础筛选
          if (filters.airline && flight.airline !== filters.airline)
            return false
          if (filters.departure && flight.departure !== filters.departure)
            return false
          if (filters.destination && flight.destination !== filters.destination)
            return false
          if (
            filters.departureProvince &&
            flight.departure_province !== filters.departureProvince
          )
            return false
          if (
            filters.destinationProvince &&
            flight.destination_province !== filters.destinationProvince
          )
            return false
          if (
            filters.flightNumber &&
            !flight.flight_number.includes(filters.flightNumber)
          )
            return false
          if (
            filters.productType &&
            flight.product_type !== filters.productType
          )
            return false

          // 航班类型筛选
          if (filters.nightFlight && !flight.is_night) return false
          if (filters.dayFlight && flight.is_night) return false

          // 起飞时间筛选
          if (filters.departureTime) {
            const hour = parseInt(flight.departure_time.split(":")[0])
            switch (filters.departureTime) {
              case "early":
                if (hour >= 6) return false
                break
              case "morning":
                if (hour < 6 || hour >= 12) return false
                break
              case "afternoon":
                if (hour < 12 || hour >= 18) return false
                break
              case "evening":
                if (hour < 18) return false
                break
            }
          }

          // 运营日期筛选
          if (filters.operatingDays.length > 0) {
            const hasMatchingDay = filters.operatingDays.some((day) =>
              flight.days.includes(day)
            )
            if (!hasMatchingDay) return false
          }

          return true
        })

        // 保存原始筛选结果
        originalFilteredData = [...filteredData]
        
        // 如果有地点搜索，应用地点筛选
        const locationSearch = document.getElementById('locationSearch').value.trim()
        if (locationSearch) {
          performLocationSearch()
        } else {
          displayResults()
        }
      }

      // 重置筛选
      function resetFilters() {
        document.getElementById("airline").value = ""
        document.getElementById("departure").value = ""
        document.getElementById("destination").value = ""
        document.getElementById("departureProvince").value = ""
        document.getElementById("destinationProvince").value = ""
        document.getElementById("flightNumber").value = ""
        document.getElementById("productType").value = ""
        document.getElementById("nightFlight").checked = false
        document.getElementById("dayFlight").checked = false
        document.getElementById("departureTime").value = ""
        document
          .querySelectorAll(".day-checkbox")
          .forEach((cb) => (cb.checked = false))
        
        // 清空地点搜索
        document.getElementById("locationSearch").value = ""
        document.getElementById("searchResultsInfo").innerHTML = 
          '<span>💡 提示：输入城市名或省份名，系统将自动筛选相关航班</span>'

        filteredData = flightData
        originalFilteredData = [...flightData]
        displayResults()
      }

      // 显示结果
      function displayResults() {
        const tbody = document.getElementById("flightTableBody")

        if (filteredData.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="9" class="px-6 py-12 text-center text-gray-500"><i class="iconfont icon-empty text-3xl mb-2 block"></i>没有找到符合条件的航班</td></tr>'
        } else {
          tbody.innerHTML = filteredData
            .map(
              (flight) => `
                    <tr class="hover:bg-gray-50 transition-colors duration-200 ${flight.is_night ? "night-flight" : ""}">
                        <td class="px-6 py-4 text-sm text-gray-900 font-medium">
                          <i class="iconfont icon-airplane text-blue-500 mr-2"></i>${flight.airline}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900 font-mono font-semibold">${flight.flight_number}</td>
                        <td class="px-6 py-4 text-sm text-gray-900">
                          <i class="iconfont icon-departure text-green-500 mr-1"></i>${flight.departure}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900">
                          <i class="iconfont icon-arrival text-red-500 mr-1"></i>${flight.destination}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900 font-mono">
                          <i class="iconfont icon-time text-blue-500 mr-1"></i>${flight.departure_time}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900 font-mono">
                          <i class="iconfont icon-time text-blue-500 mr-1"></i>${flight.arrival_time}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900">
                          <i class="iconfont icon-calendar text-purple-500 mr-1"></i>${formatOperatingDays(flight.days)}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900">
                          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            ${flight.product_type}
                          </span>
                        </td>
                        <td class="px-6 py-4 text-sm">
                          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                            flight.is_night 
                              ? 'bg-purple-100 text-purple-800' 
                              : 'bg-orange-100 text-orange-800'
                          }">
                            <i class="iconfont ${
                              flight.is_night ? 'icon-moon' : 'icon-sun'
                            } mr-1"></i>
                            ${flight.is_night ? "红眼航班" : "日间航班"}
                          </span>
                        </td>
                    </tr>
                `
            )
            .join("")
        }

        updateStats()
      }

      // 格式化运营日期
      function formatOperatingDays(days) {
        const dayMap = {
          1: "周一",
          2: "周二",
          3: "周三",
          4: "周四",
          5: "周五",
          6: "周六",
          7: "周日"
        }

        if (days === "1234567") {
          return "每日"
        }

        return days
          .split("")
          .map((d) => dayMap[d])
          .join("、")
      }

      // 更新统计信息
      function updateStats() {
        document.getElementById("totalFlights").textContent =
          filteredData.length
        document.getElementById("nightFlights").textContent =
          filteredData.filter((f) => f.is_night).length
        document.getElementById("dayFlights").textContent = filteredData.filter(
          (f) => !f.is_night
        ).length
      }

      // 导出结果
      function exportResults() {
        const csvContent = [
          [
            "航空公司",
            "航班号",
            "出发城市",
            "到达城市",
            "出发时间",
            "到达时间",
            "运营日期",
            "产品类型",
            "航班类型"
          ],
          ...filteredData.map((flight) => [
            flight.airline,
            flight.flight_number,
            flight.departure,
            flight.destination,
            flight.departure_time,
            flight.arrival_time,
            formatOperatingDays(flight.days),
            flight.product_type,
            flight.is_night ? "红眼航班" : "日间航班"
          ])
        ]
          .map((row) => row.join(","))
          .join("\n")

        const blob = new Blob(["\ufeff" + csvContent], {
          type: "text/csv;charset=utf-8;"
        })
        const link = document.createElement("a")
        link.href = URL.createObjectURL(blob)
        link.download = `航班查询结果_${new Date().toLocaleDateString()}.csv`
        link.click()
      }

      // 页面加载完成后初始化
      window.onload = function () {
        // 自动加载在线数据
        loadFlightData()

        // 备用：提供文件输入框让用户选择本地文件
        const fileInput = document.createElement("input")
        fileInput.type = "file"
        fileInput.accept = ".json"
        fileInput.style.display = "none"
        fileInput.onchange = function (e) {
          const file = e.target.files[0]
          if (file) {
            const reader = new FileReader()
            reader.onload = function (e) {
              try {
                const data = JSON.parse(e.target.result)
                flightData = data.flights
                initializeFilters()
                applyFilters()
              } catch (error) {
                alert("文件格式错误，请选择正确的JSON文件")
              }
            }
            reader.readAsText(file)
          }
        }
        document.body.appendChild(fileInput)
      }

      // 地点搜索功能
      function performLocationSearch() {
        const searchTerm = document.getElementById('locationSearch').value.trim().toLowerCase()
        const searchResultsInfo = document.getElementById('searchResultsInfo')
        
        if (!searchTerm) {
          // 如果搜索框为空，显示原始筛选结果
          filteredData = [...originalFilteredData]
          searchResultsInfo.innerHTML = '<span>💡 提示：输入城市名或省份名，系统将自动筛选相关航班</span>'
          displayResults()
          return
        }
        
        // 在原始筛选结果中进行地点搜索
        const locationFilteredData = originalFilteredData.filter(flight => {
          return (
            flight.departure.toLowerCase().includes(searchTerm) ||
            flight.destination.toLowerCase().includes(searchTerm) ||
            flight.departure_province.toLowerCase().includes(searchTerm) ||
            flight.destination_province.toLowerCase().includes(searchTerm)
          )
        })
        
        filteredData = locationFilteredData
        
        // 更新搜索结果信息
        if (locationFilteredData.length > 0) {
          const departureMatches = locationFilteredData.filter(f => 
            f.departure.toLowerCase().includes(searchTerm) || 
            f.departure_province.toLowerCase().includes(searchTerm)
          ).length
          const arrivalMatches = locationFilteredData.filter(f => 
            f.destination.toLowerCase().includes(searchTerm) || 
            f.destination_province.toLowerCase().includes(searchTerm)
          ).length
          
          let matchInfo = []
          if (departureMatches > 0) matchInfo.push(`${departureMatches}个出发航班`)
          if (arrivalMatches > 0) matchInfo.push(`${arrivalMatches}个到达航班`)
          
          searchResultsInfo.innerHTML = `
            <span>🔍 搜索"<span class="search-highlight">${searchTerm}</span>"找到 ${locationFilteredData.length} 个结果</span>
            <span>(${matchInfo.join('，')})</span>
          `
        } else {
          searchResultsInfo.innerHTML = `
            <span>🔍 搜索"<span class="search-highlight">${searchTerm}</span>"未找到相关航班</span>
            <span>请尝试其他关键词</span>
          `
        }
        
        displayResults()
      }
      
      // 清空地点搜索
      function clearLocationSearch() {
        document.getElementById('locationSearch').value = ''
        document.getElementById('searchResultsInfo').innerHTML = 
          '<span>💡 提示：输入城市名或省份名，系统将自动筛选相关航班</span>'
        
        // 恢复到原始筛选结果
        filteredData = [...originalFilteredData]
        displayResults()
      }
      
      // 切换详细搜索面板
      function toggleAdvancedSearch() {
        const filtersPanel = document.getElementById('advancedFilters')
        const toggleBtn = document.getElementById('toggleBtn')
        const toggleIcon = document.getElementById('toggleIcon')
        
        if (filtersPanel.style.display === 'none') {
          // 显示筛选面板
          filtersPanel.style.display = 'block'
          filtersPanel.classList.remove('hide')
          filtersPanel.classList.add('show')
          
          // 更新按钮状态
          toggleBtn.textContent = '收起筛选'
          toggleBtn.classList.add('expanded')
          toggleIcon.textContent = '▲'
        } else {
          // 隐藏筛选面板
          filtersPanel.classList.remove('show')
          filtersPanel.classList.add('hide')
          
          // 更新按钮状态
          toggleBtn.textContent = '详细搜索'
          toggleBtn.classList.remove('expanded')
          toggleIcon.textContent = '▼'
          
          // 延迟隐藏以等待动画完成
          setTimeout(() => {
            if (filtersPanel.classList.contains('hide')) {
              filtersPanel.style.display = 'none'
              filtersPanel.classList.remove('hide')
            }
          }, 400)
        }
      }
    </script>
  </body>
</html>
