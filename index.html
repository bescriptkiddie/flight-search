<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>èˆªç­ä¿¡æ¯ç­›é€‰ç³»ç»Ÿ</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ä½¿ç”¨Unicodeå›¾æ ‡æ›¿ä»£é˜¿é‡Œå›¾æ ‡åº“ -->
    <style>
      .icon-airplane::before { content: 'âœˆï¸'; }
      .icon-search::before { content: 'ğŸ”'; }
      .icon-close::before { content: 'âœ–ï¸'; }
      .icon-filter::before { content: 'ğŸ”½'; }
      .icon-arrow-down::before { content: 'â¬‡ï¸'; }
      .icon-tips::before { content: 'ğŸ’¡'; }
      .icon-departure::before { content: 'ğŸ›«'; }
      .icon-arrival::before { content: 'ğŸ›¬'; }
      .icon-location::before { content: 'ğŸ“'; }
      .icon-flight-number::before { content: 'ğŸ”¢'; }
      .icon-product::before { content: 'ğŸ“¦'; }
      .icon-time::before { content: 'â°'; }
      .icon-clock::before { content: 'ğŸ•'; }
      .icon-calendar::before { content: 'ğŸ“…'; }
      .icon-empty::before { content: 'ğŸ“­'; }
      .icon-moon::before { content: 'ğŸŒ™'; }
      .icon-sun::before { content: 'â˜€ï¸'; }
      .icon-export::before { content: 'ğŸ“¤'; }
      .icon-reset::before { content: 'ğŸ”„'; }
      .icon-apply::before { content: 'âœ…'; }
      .iconfont { font-style: normal; }
    </style>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              'sans': ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Microsoft YaHei', 'sans-serif']
            },
            animation: {
              'fade-in': 'fadeIn 0.5s ease-in-out',
              'slide-down': 'slideDown 0.4s ease-out',
              'slide-up': 'slideUp 0.4s ease-out'
            }
          }
        }
      }
    </script>
    <style>
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      @keyframes slideDown {
        from { opacity: 0; max-height: 0; transform: translateY(-20px); }
        to { opacity: 1; max-height: 1000px; transform: translateY(0); }
      }
      @keyframes slideUp {
        from { opacity: 1; max-height: 1000px; transform: translateY(0); }
        to { opacity: 0; max-height: 0; transform: translateY(-20px); }
      }
      .search-highlight {
        background-color: #fef3c7;
        padding: 2px 6px;
        border-radius: 4px;
        font-weight: bold;
        color: #92400e;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen font-sans">
    <div class="max-w-7xl mx-auto px-4 py-6">
      <h1 class="text-4xl md:text-5xl font-bold text-center mb-8 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent animate-fade-in">
        <i class="iconfont icon-airplane text-blue-500 mr-3"></i>
        èˆªç­ä¿¡æ¯ç­›é€‰ç³»ç»Ÿ
      </h1>

      <!-- å¿«æ·æœç´¢åŒºåŸŸ -->
      <div class="bg-white/80 backdrop-blur-lg rounded-2xl shadow-xl p-6 mb-6 border border-white/20 animate-fade-in">
        <div class="flex flex-col lg:flex-row gap-4 items-end">
          <!-- æœç´¢è¾“å…¥æ¡† -->
          <div class="flex-1 relative">
            <label class="block text-sm font-semibold text-gray-700 mb-3">
              <i class="iconfont icon-search text-blue-500 mr-2 text-lg"></i>
              å¿«æ·æœç´¢
            </label>
            <div class="relative group">
              <input
                type="text"
                id="locationSearch"
                class="w-full pl-12 pr-12 py-4 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-300 bg-gray-50/50 focus:bg-white text-gray-800 placeholder-gray-400 shadow-sm hover:shadow-md"
                placeholder="è¾“å…¥åŸå¸‚åæˆ–çœä»½åå¿«é€Ÿæœç´¢èˆªç­..."
                oninput="performLocationSearch()"
              />
              <!-- æœç´¢å›¾æ ‡ -->
              <i class="iconfont icon-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 text-xl group-focus-within:text-blue-500 transition-colors"></i>

              <!-- æ¸…é™¤æŒ‰é’® -->
              <button
                onclick="clearLocationSearch()"
                class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-red-500 transition-all duration-200 hover:scale-110 p-1 rounded-full hover:bg-red-50"
                title="æ¸…ç©ºæœç´¢"
              >
                <i class="iconfont icon-close text-lg"></i>
              </button>
            </div>
          </div>

          <!-- è¯¦ç»†æœç´¢åˆ‡æ¢æŒ‰é’® -->
          <div class="flex-shrink-0">
            <button
              class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-8 py-4 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-3 font-semibold hover:-translate-y-1 active:translate-y-0"
              id="toggleBtn"
              onclick="toggleAdvancedSearch()"
            >
              <i class="iconfont icon-filter text-lg"></i>
              <span id="toggleText">è¯¦ç»†æœç´¢</span>
              <i class="iconfont icon-arrow-down transition-transform duration-300" id="toggleIcon"></i>
            </button>
          </div>
        </div>

        <!-- æœç´¢æç¤ºä¿¡æ¯ -->
        <div class="mt-6" id="searchResultsInfo">
          <div class="flex items-center gap-4 text-sm text-gray-600 bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-4 rounded-xl border border-blue-100 shadow-sm">
            <i class="iconfont icon-tips text-blue-500 text-xl animate-pulse"></i>
            <span class="font-medium">è¾“å…¥åŸå¸‚åæˆ–çœä»½åï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ç­›é€‰ç›¸å…³èˆªç­</span>
          </div>
        </div>
      </div>

      <!-- è¯¦ç»†æœç´¢é¢æ¿ -->
      <div class="bg-white/80 backdrop-blur-lg rounded-2xl shadow-xl p-6 mb-6 border border-white/20 transition-all duration-500" id="advancedFilters" style="display: none;">
        <!-- ç¬¬ä¸€è¡Œ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
          <div class="relative group">
            <label class="block text-sm font-semibold text-gray-700 mb-3">
              <i class="iconfont icon-airplane text-blue-500 mr-2"></i>èˆªç©ºå…¬å¸
            </label>
            <select id="airline" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50/50 focus:bg-white shadow-sm hover:shadow-md">
              <option value="">å…¨éƒ¨</option>
            </select>
          </div>

          <div class="relative group">
            <label class="block text-sm font-semibold text-gray-700 mb-3">
              <i class="iconfont icon-departure text-green-500 mr-2"></i>å‡ºå‘åŸå¸‚
            </label>
            <select id="departure" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50/50 focus:bg-white shadow-sm hover:shadow-md">
              <option value="">å…¨éƒ¨</option>
            </select>
          </div>

          <div class="relative group">
            <label class="block text-sm font-semibold text-gray-700 mb-3">
              <i class="iconfont icon-arrival text-red-500 mr-2"></i>åˆ°è¾¾åŸå¸‚
            </label>
            <select id="destination" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50/50 focus:bg-white shadow-sm hover:shadow-md">
              <option value="">å…¨éƒ¨</option>
            </select>
          </div>

          <div class="relative group">
            <label class="block text-sm font-semibold text-gray-700 mb-3">
              <i class="iconfont icon-location text-purple-500 mr-2"></i>å‡ºå‘çœä»½
            </label>
            <select id="departureProvince" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50/50 focus:bg-white shadow-sm hover:shadow-md">
              <option value="">å…¨éƒ¨</option>
            </select>
          </div>
        </div>

        <!-- ç¬¬äºŒè¡Œ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
          <div class="relative group">
            <label class="block text-sm font-semibold text-gray-700 mb-3">
              <i class="iconfont icon-location text-indigo-500 mr-2"></i>åˆ°è¾¾çœä»½
            </label>
            <select id="destinationProvince" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50/50 focus:bg-white shadow-sm hover:shadow-md">
              <option value="">å…¨éƒ¨</option>
            </select>
          </div>

          <div class="relative group">
            <label class="block text-sm font-semibold text-gray-700 mb-3">
              <i class="iconfont icon-flight-number text-orange-500 mr-2"></i>èˆªç­å·
            </label>
            <input type="text" id="flightNumber" placeholder="è¾“å…¥èˆªç­å·" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50/50 focus:bg-white shadow-sm hover:shadow-md" />
          </div>

          <div class="relative group">
             <label class="block text-sm font-semibold text-gray-700 mb-3">
               <i class="iconfont icon-product text-teal-500 mr-2"></i>äº§å“ç±»å‹
             </label>
             <select id="productType" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50/50 focus:bg-white shadow-sm hover:shadow-md">
               <option value="">å…¨éƒ¨</option>
             </select>
           </div>

           <div class="relative group">
             <label class="block text-sm font-semibold text-gray-700 mb-3">
               <i class="iconfont icon-time text-pink-500 mr-2"></i>èˆªç­ç±»å‹
             </label>
             <div class="flex flex-wrap gap-3">
               <label class="flex items-center gap-2 cursor-pointer px-3 py-2 rounded-lg hover:bg-blue-50 transition-colors">
                 <input type="checkbox" id="nightFlight" value="true" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                 <span class="text-sm font-medium text-gray-700">çº¢çœ¼èˆªç­</span>
               </label>
               <label class="flex items-center gap-2 cursor-pointer px-3 py-2 rounded-lg hover:bg-blue-50 transition-colors">
                 <input type="checkbox" id="dayFlight" value="true" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                 <span class="text-sm font-medium text-gray-700">æ—¥é—´èˆªç­</span>
               </label>
             </div>
           </div>
         </div>

         <!-- ç¬¬ä¸‰è¡Œ -->
         <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
           <div class="relative group">
             <label class="block text-sm font-semibold text-gray-700 mb-3">
               <i class="iconfont icon-clock text-amber-500 mr-2"></i>èµ·é£æ—¶é—´
             </label>
             <select id="departureTime" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50/50 focus:bg-white shadow-sm hover:shadow-md">
               <option value="">å…¨éƒ¨</option>
               <option value="early">å‡Œæ™¨ (00:00-06:00)</option>
               <option value="morning">ä¸Šåˆ (06:00-12:00)</option>
               <option value="afternoon">ä¸‹åˆ (12:00-18:00)</option>
               <option value="evening">æ™šä¸Š (18:00-24:00)</option>
             </select>
           </div>

           <div class="relative group">
             <label class="block text-sm font-semibold text-gray-700 mb-3">
               <i class="iconfont icon-calendar text-emerald-500 mr-2"></i>è¿è¥æ—¥æœŸ
             </label>
             <div class="grid grid-cols-4 md:grid-cols-7 gap-2">
               <label class="flex items-center justify-center gap-1 cursor-pointer px-2 py-2 rounded-lg hover:bg-blue-50 transition-colors text-center">
                 <input type="checkbox" class="day-checkbox w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500" value="1" />
                 <span class="text-xs font-medium text-gray-700">å‘¨ä¸€</span>
               </label>
               <label class="flex items-center justify-center gap-1 cursor-pointer px-2 py-2 rounded-lg hover:bg-blue-50 transition-colors text-center">
                 <input type="checkbox" class="day-checkbox w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500" value="2" />
                 <span class="text-xs font-medium text-gray-700">å‘¨äºŒ</span>
               </label>
               <label class="flex items-center justify-center gap-1 cursor-pointer px-2 py-2 rounded-lg hover:bg-blue-50 transition-colors text-center">
                 <input type="checkbox" class="day-checkbox w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500" value="3" />
                 <span class="text-xs font-medium text-gray-700">å‘¨ä¸‰</span>
               </label>
               <label class="flex items-center justify-center gap-1 cursor-pointer px-2 py-2 rounded-lg hover:bg-blue-50 transition-colors text-center">
                 <input type="checkbox" class="day-checkbox w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500" value="4" />
                 <span class="text-xs font-medium text-gray-700">å‘¨å››</span>
               </label>
               <label class="flex items-center justify-center gap-1 cursor-pointer px-2 py-2 rounded-lg hover:bg-blue-50 transition-colors text-center">
                 <input type="checkbox" class="day-checkbox w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500" value="5" />
                 <span class="text-xs font-medium text-gray-700">å‘¨äº”</span>
               </label>
               <label class="flex items-center justify-center gap-1 cursor-pointer px-2 py-2 rounded-lg hover:bg-blue-50 transition-colors text-center">
                 <input type="checkbox" class="day-checkbox w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500" value="6" />
                 <span class="text-xs font-medium text-gray-700">å‘¨å…­</span>
               </label>
               <label class="flex items-center justify-center gap-1 cursor-pointer px-2 py-2 rounded-lg hover:bg-blue-50 transition-colors text-center">
                 <input type="checkbox" class="day-checkbox w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500" value="7" />
                 <span class="text-xs font-medium text-gray-700">å‘¨æ—¥</span>
               </label>
             </div>
           </div>
         </div>

         <!-- æŒ‰é’®ç»„ -->
         <div class="flex flex-col sm:flex-row gap-4">
           <button class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-6 py-3 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl font-semibold hover:-translate-y-1 active:translate-y-0" onclick="applyFilters()">
             <i class="iconfont icon-check mr-2"></i>
             åº”ç”¨ç­›é€‰
           </button>
           <button class="flex-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-6 py-3 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl font-semibold hover:-translate-y-1 active:translate-y-0" onclick="resetFilters()">
             <i class="iconfont icon-refresh mr-2"></i>
             é‡ç½®ç­›é€‰
           </button>
         </div>
       </div>

       <!-- æŸ¥è¯¢ç»“æœä¿¡æ¯ -->
       <div class="bg-white/80 backdrop-blur-lg rounded-2xl shadow-xl p-6 mb-6 border border-white/20">
         <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
           <div>
             <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
               <i class="iconfont icon-data text-blue-500 text-2xl"></i>
               æŸ¥è¯¢ç»“æœ
             </h3>
             <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
               <div class="flex items-center gap-3 px-4 py-3 bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl border border-blue-200">
                 <i class="iconfont icon-airplane text-blue-500 text-xl"></i>
                 <div>
                   <span class="text-sm text-gray-600 block">æ€»èˆªç­æ•°</span>
                   <span class="text-xl font-bold text-blue-600" id="totalFlights">0</span>
                 </div>
               </div>
               <div class="flex items-center gap-3 px-4 py-3 bg-gradient-to-r from-purple-50 to-purple-100 rounded-xl border border-purple-200">
                 <i class="iconfont icon-moon text-purple-500 text-xl"></i>
                 <div>
                   <span class="text-sm text-gray-600 block">çº¢çœ¼èˆªç­</span>
                   <span class="text-xl font-bold text-purple-600" id="nightFlights">0</span>
                 </div>
               </div>
               <div class="flex items-center gap-3 px-4 py-3 bg-gradient-to-r from-orange-50 to-orange-100 rounded-xl border border-orange-200">
                 <i class="iconfont icon-sun text-orange-500 text-xl"></i>
                 <div>
                   <span class="text-sm text-gray-600 block">æ—¥é—´èˆªç­</span>
                   <span class="text-xl font-bold text-orange-600" id="dayFlights">0</span>
                 </div>
               </div>
             </div>
           </div>
           <div class="flex-shrink-0">
             <button class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 py-3 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl font-semibold hover:-translate-y-1 active:translate-y-0 flex items-center gap-2" onclick="exportResults()">
               <i class="iconfont icon-download text-lg"></i>
               å¯¼å‡ºç»“æœ
             </button>
           </div>
         </div>
       </div>

       <!-- èˆªç­åˆ—è¡¨ -->
       <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
         <div class="overflow-x-auto">
           <table id="flightTable" class="w-full">
             <thead>
               <tr class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white">
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-airplane mr-2"></i>èˆªç©ºå…¬å¸
                 </th>
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-flight-number mr-2"></i>èˆªç­å·
                 </th>
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-departure mr-2"></i>å‡ºå‘åŸå¸‚
                 </th>
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-arrival mr-2"></i>åˆ°è¾¾åŸå¸‚
                 </th>
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-time mr-2"></i>å‡ºå‘æ—¶é—´
                 </th>
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-time mr-2"></i>åˆ°è¾¾æ—¶é—´
                 </th>
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-calendar mr-2"></i>è¿è¥æ—¥æœŸ
                 </th>
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-product mr-2"></i>äº§å“ç±»å‹
                 </th>
                 <th class="px-6 py-4 text-left font-semibold">
                   <i class="iconfont icon-type mr-2"></i>èˆªç­ç±»å‹
                 </th>
               </tr>
             </thead>
             <tbody id="flightTableBody" class="divide-y divide-gray-100">
               <tr>
                 <td colspan="9" class="px-6 py-12 text-center text-gray-500 animate-pulse">
                   <i class="iconfont icon-loading text-3xl mb-2 block"></i>
                   æ­£åœ¨åŠ è½½æ•°æ®...
                 </td>
               </tr>
             </tbody>
           </table>
         </div>
       </div>
     </div>
      /* å¤œé—´èˆªç­æ ‡è¯† */
      .night-flight {
        @apply border-l-4 border-blue-600 bg-gradient-to-r from-blue-50 to-white;
      }

      /* æœç´¢é«˜äº® */
      .search-highlight {
        @apply bg-yellow-100 px-2 py-1 rounded font-semibold text-yellow-800;
      }

      /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f5f9;
      }

      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="text-4xl md:text-5xl font-bold text-center mb-8 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">âœˆï¸ èˆªç­ä¿¡æ¯ç­›é€‰ç³»ç»Ÿ</h1>

      <!-- å¿«æ·æœç´¢åŒºåŸŸ -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-6 border border-gray-100">
        <div class="flex flex-col lg:flex-row gap-4 items-end">
          <!-- æœç´¢è¾“å…¥æ¡† -->
          <div class="flex-1 relative">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="iconfont icon-search text-blue-500 mr-1"></i>
              å¿«æ·æœç´¢
            </label>
            <div class="relative">
              <input
                type="text"
                id="locationSearch"
                class="w-full pl-10 pr-10 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 bg-gray-50 focus:bg-white"
                placeholder="è¾“å…¥åŸå¸‚åæˆ–çœä»½åå¿«é€Ÿæœç´¢èˆªç­..."
                oninput="performLocationSearch()"
              />
              <!-- æœç´¢å›¾æ ‡ -->
              <i class="iconfont icon-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-lg"></i>

              <!-- æ¸…é™¤æŒ‰é’® -->
              <button
                onclick="clearLocationSearch()"
                class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors"
                title="æ¸…ç©ºæœç´¢"
              >
                <i class="iconfont icon-close text-lg"></i>
              </button>
            </div>
          </div>

          <!-- è¯¦ç»†æœç´¢åˆ‡æ¢æŒ‰é’® -->
          <div class="flex-shrink-0">
            <button
              class="btn-toggle bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-6 py-3 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg flex items-center gap-2"
              id="toggleBtn"
              onclick="toggleAdvancedSearch()"
            >
              <i class="iconfont icon-filter text-sm"></i>
              <span id="toggleText">è¯¦ç»†æœç´¢</span>
              <i class="iconfont icon-arrow-down transition-transform duration-200" id="toggleIcon"></i>
            </button>
          </div>
        </div>

        <!-- æœç´¢æç¤ºä¿¡æ¯ -->
        <div class="mt-4" id="searchResultsInfo">
          <div class="flex items-center gap-3 text-sm text-gray-600 bg-gradient-to-r from-blue-50 to-indigo-50 px-4 py-3 rounded-lg border border-blue-100">
            <i class="iconfont icon-tips text-blue-500 text-lg animate-pulse"></i>
            <span>è¾“å…¥åŸå¸‚åæˆ–çœä»½åï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ç­›é€‰ç›¸å…³èˆªç­</span>
          </div>
        </div>
      </div>

      <!-- è¯¦ç»†æœç´¢é¢æ¿ -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-6 border border-gray-100" id="advancedFilters" style="display: none;">
        <!-- ç¬¬ä¸€è¡Œ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
          <div class="relative">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="iconfont icon-airplane text-blue-500 mr-1"></i>èˆªç©ºå…¬å¸
            </label>
            <select id="airline" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200">
              <option value="">å…¨éƒ¨</option>
            </select>
          </div>

          <div class="relative">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="iconfont icon-departure text-green-500 mr-1"></i>å‡ºå‘åŸå¸‚
            </label>
            <select id="departure" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200">
              <option value="">å…¨éƒ¨</option>
            </select>
          </div>

          <div class="relative">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="iconfont icon-arrival text-red-500 mr-1"></i>åˆ°è¾¾åŸå¸‚
            </label>
            <select id="destination" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200">
              <option value="">å…¨éƒ¨</option>
            </select>
          </div>

          <div class="relative">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="iconfont icon-location text-purple-500 mr-1"></i>å‡ºå‘çœä»½
            </label>
            <select id="departureProvince" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200">
              <option value="">å…¨éƒ¨</option>
            </select>
          </div>
        </div>

        <!-- ç¬¬äºŒè¡Œ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
          <div class="relative">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="iconfont icon-location text-indigo-500 mr-1"></i>åˆ°è¾¾çœä»½
            </label>
            <select id="destinationProvince" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200">
              <option value="">å…¨éƒ¨</option>
            </select>
          </div>

          <div class="relative">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="iconfont icon-flight-number text-orange-500 mr-1"></i>èˆªç­å·
            </label>
            <input type="text" id="flightNumber" placeholder="è¾“å…¥èˆªç­å·" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200" />
          </div>

          <div class="filter-group">
            <label for="productType">äº§å“ç±»å‹</label>
            <select id="productType">
              <option value="">å…¨éƒ¨</option>
            </select>
          </div>

          <div class="filter-group">
            <label>èˆªç­ç±»å‹</label>
            <div class="checkbox-group">
              <label>
                <input type="checkbox" id="nightFlight" value="true" />
                çº¢çœ¼èˆªç­
              </label>
              <label>
                <input type="checkbox" id="dayFlight" value="true" />
                æ—¥é—´èˆªç­
              </label>
            </div>
          </div>
        </div>

        <div class="filter-row">
          <div class="filter-group">
            <label for="departureTime">èµ·é£æ—¶é—´</label>
            <select id="departureTime">
              <option value="">å…¨éƒ¨</option>
              <option value="early">å‡Œæ™¨ (00:00-06:00)</option>
              <option value="morning">ä¸Šåˆ (06:00-12:00)</option>
              <option value="afternoon">ä¸‹åˆ (12:00-18:00)</option>
              <option value="evening">æ™šä¸Š (18:00-24:00)</option>
            </select>
          </div>

          <div class="filter-group">
            <label for="operatingDays">è¿è¥æ—¥æœŸ</label>
            <div class="checkbox-group">
              <label
                ><input type="checkbox" class="day-checkbox" value="1" />
                å‘¨ä¸€</label
              >
              <label
                ><input type="checkbox" class="day-checkbox" value="2" />
                å‘¨äºŒ</label
              >
              <label
                ><input type="checkbox" class="day-checkbox" value="3" />
                å‘¨ä¸‰</label
              >
              <label
                ><input type="checkbox" class="day-checkbox" value="4" />
                å‘¨å››</label
              >
              <label
                ><input type="checkbox" class="day-checkbox" value="5" />
                å‘¨äº”</label
              >
              <label
                ><input type="checkbox" class="day-checkbox" value="6" />
                å‘¨å…­</label
              >
              <label
                ><input type="checkbox" class="day-checkbox" value="7" />
                å‘¨æ—¥</label
              >
            </div>
          </div>
        </div>

        <div class="button-group">
          <button class="btn-primary" onclick="applyFilters()">åº”ç”¨ç­›é€‰</button>
          <button class="btn-secondary" onclick="resetFilters()">
            é‡ç½®ç­›é€‰
          </button>
        </div>
      </div>

      <div class="results-info">
        <div>
          <h3>æŸ¥è¯¢ç»“æœ</h3>
          <div class="stats">
            <div class="stat-item">
              <span class="stat-label">æ€»èˆªç­æ•°ï¼š</span>
              <span class="stat-value" id="totalFlights">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">çº¢çœ¼èˆªç­ï¼š</span>
              <span class="stat-value" id="nightFlights">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">æ—¥é—´èˆªç­ï¼š</span>
              <span class="stat-value" id="dayFlights">0</span>
            </div>
          </div>
        </div>
        <div>
          <button class="btn-primary" onclick="exportResults()">
            å¯¼å‡ºç»“æœ
          </button>
        </div>
      </div>

      <div class="flight-table">
        <table id="flightTable">
          <thead>
            <tr>
              <th>èˆªç©ºå…¬å¸</th>
              <th>èˆªç­å·</th>
              <th>å‡ºå‘åŸå¸‚</th>
              <th>åˆ°è¾¾åŸå¸‚</th>
              <th>å‡ºå‘æ—¶é—´</th>
              <th>åˆ°è¾¾æ—¶é—´</th>
              <th>è¿è¥æ—¥æœŸ</th>
              <th>äº§å“ç±»å‹</th>
              <th>èˆªç­ç±»å‹</th>
            </tr>
          </thead>
          <tbody id="flightTableBody">
            <tr>
              <td colspan="9" class="loading">æ­£åœ¨åŠ è½½æ•°æ®...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <script>
      let flightData = []
      let filteredData = []
      let originalFilteredData = [] // ä¿å­˜åŸå§‹ç­›é€‰ç»“æœï¼Œç”¨äºåœ°ç‚¹æœç´¢

      // åŠ è½½èˆªç­æ•°æ®
      async function loadFlightData() {
        console.log("å¼€å§‹åŠ è½½èˆªç­æ•°æ®...")
        document.getElementById("flightTableBody").innerHTML =
          '<tr><td colspan="9" class="no-results">æ­£åœ¨åŠ è½½æ•°æ®ï¼Œè¯·ç¨å€™...</td></tr>'

        // ä¼˜å…ˆå°è¯•æœ¬åœ°æ•°æ®
        try {
          console.log("å°è¯•åŠ è½½æœ¬åœ°æ•°æ®: ./flights_data.json")
          const localResponse = await fetch("./flights_data.json")
          if (localResponse.ok) {
            const localData = await localResponse.json()
            console.log("æˆåŠŸåŠ è½½æœ¬åœ°æ•°æ®:", localData)
            console.log(
              "èˆªç­æ•°é‡:",
              localData.flights ? localData.flights.length : 0
            )

            if (localData.flights && Array.isArray(localData.flights)) {
              flightData = localData.flights
              console.log("æœ¬åœ°æ•°æ®åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–ç­›é€‰å™¨")
              initializeFilters()
              applyFilters()
              console.log("é¡µé¢åˆå§‹åŒ–å®Œæˆ")
              return
            }
          }
        } catch (localError) {
          console.log("æœ¬åœ°æ•°æ®ä¸å¯ç”¨ï¼Œå°è¯•åœ¨çº¿æ•°æ®:", localError.message)
        }

        // å¦‚æœæœ¬åœ°æ•°æ®ä¸å¯ç”¨ï¼Œå°è¯•åœ¨çº¿æ•°æ®
        try {
          console.log(
            "å‘é€ç½‘ç»œè¯·æ±‚åˆ°: https://flight-route.surge.sh/flights_data.json"
          )

          // å°è¯•ä½¿ç”¨CORSä»£ç†
          const corsProxyUrls = [
            "https://cors-anywhere.herokuapp.com/https://flight-route.surge.sh/flights_data.json",
            "https://api.allorigins.win/get?url=https://flight-route.surge.sh/flights_data.json",
            "https://flight-route.surge.sh/flights_data.json"
          ]

          let response = null
          let data = null

          for (const url of corsProxyUrls) {
            try {
              console.log("å°è¯•URL:", url)
              response = await fetch(url, {
                method: "GET",
                mode: "cors",
                headers: {
                  Accept: "application/json"
                }
              })

              if (response.ok) {
                console.log("å“åº”çŠ¶æ€:", response.status, response.statusText)
                const responseData = await response.json()

                // å¤„ç†ä¸åŒä»£ç†çš„å“åº”æ ¼å¼
                if (url.includes("allorigins.win")) {
                  data = JSON.parse(responseData.contents)
                } else {
                  data = responseData
                }

                console.log("æˆåŠŸè·å–åœ¨çº¿æ•°æ®:", data)
                break
              }
            } catch (proxyError) {
              console.log(`ä»£ç† ${url} å¤±è´¥:`, proxyError.message)
              continue
            }
          }

          if (!data || !data.flights || !Array.isArray(data.flights)) {
            throw new Error("æ— æ³•è·å–æœ‰æ•ˆçš„èˆªç­æ•°æ®")
          }

          console.log("èˆªç­æ•°é‡:", data.flights.length)
          flightData = data.flights
          console.log("åœ¨çº¿æ•°æ®åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–ç­›é€‰å™¨")
          initializeFilters()
          applyFilters()
          console.log("é¡µé¢åˆå§‹åŒ–å®Œæˆ")
        } catch (error) {
          console.error("æ‰€æœ‰æ•°æ®æºåŠ è½½å¤±è´¥:", error)
          console.error("é”™è¯¯è¯¦æƒ…:", error.message)

          document.getElementById(
            "flightTableBody"
          ).innerHTML = `<tr><td colspan="9" class="no-results">æ•°æ®åŠ è½½å¤±è´¥: ${error.message}<br><br>å¯èƒ½çš„åŸå› ï¼š<br>1. æœ¬åœ°æ–‡ä»¶ flights_data.json ä¸å­˜åœ¨<br>2. ç½‘ç»œè¿æ¥é—®é¢˜<br>3. è·¨åŸŸè¯·æ±‚è¢«é˜»æ­¢<br>4. æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨<br><br><button class="btn-primary" onclick="loadFlightData()">é‡è¯•</button><br><br><button class="btn-primary" onclick="document.querySelector('input[type=file]').click()">é€‰æ‹©æœ¬åœ°æ–‡ä»¶</button></td></tr>`
        }
      }

      // åˆå§‹åŒ–ç­›é€‰å™¨é€‰é¡¹
      function initializeFilters() {
        const airlines = [...new Set(flightData.map((f) => f.airline))].sort()
        const departures = [
          ...new Set(flightData.map((f) => f.departure))
        ].sort()
        const destinations = [
          ...new Set(flightData.map((f) => f.destination))
        ].sort()
        const departureProvinces = [
          ...new Set(flightData.map((f) => f.departure_province))
        ].sort()
        const destinationProvinces = [
          ...new Set(flightData.map((f) => f.destination_province))
        ].sort()
        const productTypes = [
          ...new Set(flightData.map((f) => f.product_type))
        ].sort()

        populateSelect("airline", airlines)
        populateSelect("departure", departures)
        populateSelect("destination", destinations)
        populateSelect("departureProvince", departureProvinces)
        populateSelect("destinationProvince", destinationProvinces)
        populateSelect("productType", productTypes)
      }

      // å¡«å……ä¸‹æ‹‰é€‰é¡¹
      function populateSelect(id, options) {
        const select = document.getElementById(id)
        options.forEach((option) => {
          const optionElement = document.createElement("option")
          optionElement.value = option
          optionElement.textContent = option
          select.appendChild(optionElement)
        })
      }

      // åº”ç”¨ç­›é€‰
      function applyFilters() {
        const filters = {
          airline: document.getElementById("airline").value,
          departure: document.getElementById("departure").value,
          destination: document.getElementById("destination").value,
          departureProvince: document.getElementById("departureProvince").value,
          destinationProvince: document.getElementById("destinationProvince")
            .value,
          flightNumber: document
            .getElementById("flightNumber")
            .value.toUpperCase(),
          productType: document.getElementById("productType").value,
          nightFlight: document.getElementById("nightFlight").checked,
          dayFlight: document.getElementById("dayFlight").checked,
          departureTime: document.getElementById("departureTime").value,
          operatingDays: Array.from(
            document.querySelectorAll(".day-checkbox:checked")
          ).map((cb) => cb.value)
        }

        filteredData = flightData.filter((flight) => {
          // åŸºç¡€ç­›é€‰
          if (filters.airline && flight.airline !== filters.airline)
            return false
          if (filters.departure && flight.departure !== filters.departure)
            return false
          if (filters.destination && flight.destination !== filters.destination)
            return false
          if (
            filters.departureProvince &&
            flight.departure_province !== filters.departureProvince
          )
            return false
          if (
            filters.destinationProvince &&
            flight.destination_province !== filters.destinationProvince
          )
            return false
          if (
            filters.flightNumber &&
            !flight.flight_number.includes(filters.flightNumber)
          )
            return false
          if (
            filters.productType &&
            flight.product_type !== filters.productType
          )
            return false

          // èˆªç­ç±»å‹ç­›é€‰
          if (filters.nightFlight && !flight.is_night) return false
          if (filters.dayFlight && flight.is_night) return false

          // èµ·é£æ—¶é—´ç­›é€‰
          if (filters.departureTime) {
            const hour = parseInt(flight.departure_time.split(":")[0])
            switch (filters.departureTime) {
              case "early":
                if (hour >= 6) return false
                break
              case "morning":
                if (hour < 6 || hour >= 12) return false
                break
              case "afternoon":
                if (hour < 12 || hour >= 18) return false
                break
              case "evening":
                if (hour < 18) return false
                break
            }
          }

          // è¿è¥æ—¥æœŸç­›é€‰
          if (filters.operatingDays.length > 0) {
            const hasMatchingDay = filters.operatingDays.some((day) =>
              flight.days.includes(day)
            )
            if (!hasMatchingDay) return false
          }

          return true
        })

        // ä¿å­˜åŸå§‹ç­›é€‰ç»“æœ
        originalFilteredData = [...filteredData]
        
        // å¦‚æœæœ‰åœ°ç‚¹æœç´¢ï¼Œåº”ç”¨åœ°ç‚¹ç­›é€‰
        const locationSearch = document.getElementById('locationSearch').value.trim()
        if (locationSearch) {
          performLocationSearch()
        } else {
          displayResults()
        }
      }

      // é‡ç½®ç­›é€‰
      function resetFilters() {
        document.getElementById("airline").value = ""
        document.getElementById("departure").value = ""
        document.getElementById("destination").value = ""
        document.getElementById("departureProvince").value = ""
        document.getElementById("destinationProvince").value = ""
        document.getElementById("flightNumber").value = ""
        document.getElementById("productType").value = ""
        document.getElementById("nightFlight").checked = false
        document.getElementById("dayFlight").checked = false
        document.getElementById("departureTime").value = ""
        document
          .querySelectorAll(".day-checkbox")
          .forEach((cb) => (cb.checked = false))
        
        // æ¸…ç©ºåœ°ç‚¹æœç´¢
        document.getElementById("locationSearch").value = ""
        document.getElementById("searchResultsInfo").innerHTML = 
          '<span>ğŸ’¡ æç¤ºï¼šè¾“å…¥åŸå¸‚åæˆ–çœä»½åï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ç­›é€‰ç›¸å…³èˆªç­</span>'

        filteredData = flightData
        originalFilteredData = [...flightData]
        displayResults()
      }

      // æ˜¾ç¤ºç»“æœ
      function displayResults() {
        const tbody = document.getElementById("flightTableBody")

        if (filteredData.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="9" class="px-6 py-12 text-center text-gray-500"><i class="iconfont icon-empty text-3xl mb-2 block"></i>æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„èˆªç­</td></tr>'
        } else {
          tbody.innerHTML = filteredData
            .map(
              (flight) => `
                    <tr class="hover:bg-gray-50 transition-colors duration-200 ${flight.is_night ? "night-flight" : ""}">
                        <td class="px-6 py-4 text-sm text-gray-900 font-medium">
                          <i class="iconfont icon-airplane text-blue-500 mr-2"></i>${flight.airline}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900 font-mono font-semibold">${flight.flight_number}</td>
                        <td class="px-6 py-4 text-sm text-gray-900">
                          <i class="iconfont icon-departure text-green-500 mr-1"></i>${flight.departure}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900">
                          <i class="iconfont icon-arrival text-red-500 mr-1"></i>${flight.destination}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900 font-mono">
                          <i class="iconfont icon-time text-blue-500 mr-1"></i>${flight.departure_time}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900 font-mono">
                          <i class="iconfont icon-time text-blue-500 mr-1"></i>${flight.arrival_time}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900">
                          <i class="iconfont icon-calendar text-purple-500 mr-1"></i>${formatOperatingDays(flight.days)}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900">
                          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            ${flight.product_type}
                          </span>
                        </td>
                        <td class="px-6 py-4 text-sm">
                          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                            flight.is_night 
                              ? 'bg-purple-100 text-purple-800' 
                              : 'bg-orange-100 text-orange-800'
                          }">
                            <i class="iconfont ${
                              flight.is_night ? 'icon-moon' : 'icon-sun'
                            } mr-1"></i>
                            ${flight.is_night ? "çº¢çœ¼èˆªç­" : "æ—¥é—´èˆªç­"}
                          </span>
                        </td>
                    </tr>
                `
            )
            .join("")
        }

        updateStats()
      }

      // æ ¼å¼åŒ–è¿è¥æ—¥æœŸ
      function formatOperatingDays(days) {
        const dayMap = {
          1: "å‘¨ä¸€",
          2: "å‘¨äºŒ",
          3: "å‘¨ä¸‰",
          4: "å‘¨å››",
          5: "å‘¨äº”",
          6: "å‘¨å…­",
          7: "å‘¨æ—¥"
        }

        if (days === "1234567") {
          return "æ¯æ—¥"
        }

        return days
          .split("")
          .map((d) => dayMap[d])
          .join("ã€")
      }

      // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
      function updateStats() {
        document.getElementById("totalFlights").textContent =
          filteredData.length
        document.getElementById("nightFlights").textContent =
          filteredData.filter((f) => f.is_night).length
        document.getElementById("dayFlights").textContent = filteredData.filter(
          (f) => !f.is_night
        ).length
      }

      // å¯¼å‡ºç»“æœ
      function exportResults() {
        const csvContent = [
          [
            "èˆªç©ºå…¬å¸",
            "èˆªç­å·",
            "å‡ºå‘åŸå¸‚",
            "åˆ°è¾¾åŸå¸‚",
            "å‡ºå‘æ—¶é—´",
            "åˆ°è¾¾æ—¶é—´",
            "è¿è¥æ—¥æœŸ",
            "äº§å“ç±»å‹",
            "èˆªç­ç±»å‹"
          ],
          ...filteredData.map((flight) => [
            flight.airline,
            flight.flight_number,
            flight.departure,
            flight.destination,
            flight.departure_time,
            flight.arrival_time,
            formatOperatingDays(flight.days),
            flight.product_type,
            flight.is_night ? "çº¢çœ¼èˆªç­" : "æ—¥é—´èˆªç­"
          ])
        ]
          .map((row) => row.join(","))
          .join("\n")

        const blob = new Blob(["\ufeff" + csvContent], {
          type: "text/csv;charset=utf-8;"
        })
        const link = document.createElement("a")
        link.href = URL.createObjectURL(blob)
        link.download = `èˆªç­æŸ¥è¯¢ç»“æœ_${new Date().toLocaleDateString()}.csv`
        link.click()
      }

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
      window.onload = function () {
        // è‡ªåŠ¨åŠ è½½åœ¨çº¿æ•°æ®
        loadFlightData()

        // å¤‡ç”¨ï¼šæä¾›æ–‡ä»¶è¾“å…¥æ¡†è®©ç”¨æˆ·é€‰æ‹©æœ¬åœ°æ–‡ä»¶
        const fileInput = document.createElement("input")
        fileInput.type = "file"
        fileInput.accept = ".json"
        fileInput.style.display = "none"
        fileInput.onchange = function (e) {
          const file = e.target.files[0]
          if (file) {
            const reader = new FileReader()
            reader.onload = function (e) {
              try {
                const data = JSON.parse(e.target.result)
                flightData = data.flights
                initializeFilters()
                applyFilters()
              } catch (error) {
                alert("æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œè¯·é€‰æ‹©æ­£ç¡®çš„JSONæ–‡ä»¶")
              }
            }
            reader.readAsText(file)
          }
        }
        document.body.appendChild(fileInput)
      }

      // åœ°ç‚¹æœç´¢åŠŸèƒ½
      function performLocationSearch() {
        const searchTerm = document.getElementById('locationSearch').value.trim().toLowerCase()
        const searchResultsInfo = document.getElementById('searchResultsInfo')
        
        if (!searchTerm) {
          // å¦‚æœæœç´¢æ¡†ä¸ºç©ºï¼Œæ˜¾ç¤ºåŸå§‹ç­›é€‰ç»“æœ
          filteredData = [...originalFilteredData]
          searchResultsInfo.innerHTML = '<span>ğŸ’¡ æç¤ºï¼šè¾“å…¥åŸå¸‚åæˆ–çœä»½åï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ç­›é€‰ç›¸å…³èˆªç­</span>'
          displayResults()
          return
        }
        
        // åœ¨åŸå§‹ç­›é€‰ç»“æœä¸­è¿›è¡Œåœ°ç‚¹æœç´¢
        const locationFilteredData = originalFilteredData.filter(flight => {
          return (
            flight.departure.toLowerCase().includes(searchTerm) ||
            flight.destination.toLowerCase().includes(searchTerm) ||
            flight.departure_province.toLowerCase().includes(searchTerm) ||
            flight.destination_province.toLowerCase().includes(searchTerm)
          )
        })
        
        filteredData = locationFilteredData
        
        // æ›´æ–°æœç´¢ç»“æœä¿¡æ¯
        if (locationFilteredData.length > 0) {
          const departureMatches = locationFilteredData.filter(f => 
            f.departure.toLowerCase().includes(searchTerm) || 
            f.departure_province.toLowerCase().includes(searchTerm)
          ).length
          const arrivalMatches = locationFilteredData.filter(f => 
            f.destination.toLowerCase().includes(searchTerm) || 
            f.destination_province.toLowerCase().includes(searchTerm)
          ).length
          
          let matchInfo = []
          if (departureMatches > 0) matchInfo.push(`${departureMatches}ä¸ªå‡ºå‘èˆªç­`)
          if (arrivalMatches > 0) matchInfo.push(`${arrivalMatches}ä¸ªåˆ°è¾¾èˆªç­`)
          
          searchResultsInfo.innerHTML = `
            <span>ğŸ” æœç´¢"<span class="search-highlight">${searchTerm}</span>"æ‰¾åˆ° ${locationFilteredData.length} ä¸ªç»“æœ</span>
            <span>(${matchInfo.join('ï¼Œ')})</span>
          `
        } else {
          searchResultsInfo.innerHTML = `
            <span>ğŸ” æœç´¢"<span class="search-highlight">${searchTerm}</span>"æœªæ‰¾åˆ°ç›¸å…³èˆªç­</span>
            <span>è¯·å°è¯•å…¶ä»–å…³é”®è¯</span>
          `
        }
        
        displayResults()
      }
      
      // æ¸…ç©ºåœ°ç‚¹æœç´¢
      function clearLocationSearch() {
        document.getElementById('locationSearch').value = ''
        document.getElementById('searchResultsInfo').innerHTML = 
          '<span>ğŸ’¡ æç¤ºï¼šè¾“å…¥åŸå¸‚åæˆ–çœä»½åï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ç­›é€‰ç›¸å…³èˆªç­</span>'
        
        // æ¢å¤åˆ°åŸå§‹ç­›é€‰ç»“æœ
        filteredData = [...originalFilteredData]
        displayResults()
      }
      
      // åˆ‡æ¢è¯¦ç»†æœç´¢é¢æ¿
      function toggleAdvancedSearch() {
        const filtersPanel = document.getElementById('advancedFilters')
        const toggleBtn = document.getElementById('toggleBtn')
        const toggleIcon = document.getElementById('toggleIcon')
        
        if (filtersPanel.style.display === 'none') {
          // æ˜¾ç¤ºç­›é€‰é¢æ¿
          filtersPanel.style.display = 'block'
          filtersPanel.classList.remove('hide')
          filtersPanel.classList.add('show')
          
          // æ›´æ–°æŒ‰é’®çŠ¶æ€
          toggleBtn.textContent = 'æ”¶èµ·ç­›é€‰'
          toggleBtn.classList.add('expanded')
          toggleIcon.textContent = 'â–²'
        } else {
          // éšè—ç­›é€‰é¢æ¿
          filtersPanel.classList.remove('show')
          filtersPanel.classList.add('hide')
          
          // æ›´æ–°æŒ‰é’®çŠ¶æ€
          toggleBtn.textContent = 'è¯¦ç»†æœç´¢'
          toggleBtn.classList.remove('expanded')
          toggleIcon.textContent = 'â–¼'
          
          // å»¶è¿Ÿéšè—ä»¥ç­‰å¾…åŠ¨ç”»å®Œæˆ
          setTimeout(() => {
            if (filtersPanel.classList.contains('hide')) {
              filtersPanel.style.display = 'none'
              filtersPanel.classList.remove('hide')
            }
          }, 400)
        }
      }
    </script>
  </body>
</html>
